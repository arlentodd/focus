{{ template "gf-content-without-sidebar" ( include "index/register/register.content.html" . ) }}

<script type="text/javascript">
    jQuery(function ($) {
        gf.reloadCaptcha();

        $('#registerForm').validate({
            errorElement: 'div',
            errorClass: 'validation-error-block',
            focusInvalid: true,
            rules: {
                password2: {
                    equalTo: '#password',
                },
            },
            messages: {
                passport: {
                    required: '请输入账号',
                },
                password: {
                    required: '请输入密码',
                },
                password2: {
                    required: '请确认密码',
                    equalTo: '输入的新密码两次不同',
                },
                nickname: {
                    required: '请确认昵称',
                },
                captcha: {
                    required: '请确认验证码',
                },
            },
            submitHandler: function (form) {
                $('button[type=submit]').attr('disabled', 'true');

                // 传输加密
                let passport = $('[name="passport"]').val();
                let password = $('[name="password"]').val();
                let password2 = $('[name="password2"]').val();
                $('[name="password"]').val(hex_md5(passport + password));
                $('[name="password2"]').val(hex_md5(passport + password2));

                jQuery(form).ajaxSubmit({
                    dataType: 'json',
                    success: function (r, textStatus) {
                        if (r.code == 0) {
                            swal({
                                title: '注册成功',
                                text: '页面将自动跳转到注册前页面',
                                icon: 'success',
                                timer: 2000,
                                buttons: false,
                            }).then((value) => {
                                if (r.redirect != '') {
                                    window.location.href = r.redirect;
                                } else {
                                    window.location.href = '/';
                                }
                            });
                        } else {
                            if (r.message != '') {
                                swal({
                                    text: r.message,
                                    icon: 'warning',
                                    button: '确定',
                                });
                            }
                            $('[name="captcha"]').val('');
                            $('[name="password"]').val(password);
                            $('[name="password2"]').val(password2);
                            gf.reloadCaptcha();
                        }
                    },
                });
                $('button[type=submit]').removeAttr('disabled');
            },
            errorPlacement: function (error, element) {
                element.addClass('is-invalid');
                error.appendTo(element.parent());
            },
        });
    });
</script>
