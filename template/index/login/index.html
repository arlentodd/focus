{{ template "gf-content-without-sidebar" (include "index/login/login.content.html" .) }}

<script type="text/javascript">
    jQuery(function ($) {
        gf.reloadCaptcha();

        $('#loginForm').validate({
            errorElement: 'div',
            errorClass: 'validation-error-block',
            focusInvalid: true,
            messages: {
                passport: {
                    required: '请输入账号',
                },
                password: {
                    required: '请输入密码',
                },
                captcha: {
                    required: '请确认验证码',
                },
            },
            submitHandler: function (form) {
                $('button[type=submit]').attr('disabled', 'true');

                let passport = $('[name="passport"]').val();
                let password = $('[name="password"]').val();
                $('[name="password"]').val(hex_md5(passport + password));

                jQuery(form).ajaxSubmit({
                    dataType: 'json',
                    success: function (r, textStatus) {
                        if (r.code == 0) {
                            swal({
                                title: '登录成功',
                                text: '页面将自动跳转到登录前页面',
                                icon: 'success',
                                timer: 2000,
                                buttons: false,
                            }).then((value) => {
                                if (r.redirect != '') {
                                    window.location.href = r.redirect;
                                } else {
                                    window.location.href = '/';
                                }
                            });
                        } else {
                            swal({
                                text: r.message,
                                icon: 'warning',
                                button: '确定',
                            });
                            $('[name="password"]').val('');
                            gf.reloadCaptcha();
                        }
                    },
                });
                $('button[type=submit]').removeAttr('disabled');
            },
            errorPlacement: function (error, element) {
                element.addClass('is-invalid');
                error.appendTo(element.parent());
            },
        });
    });
</script>
